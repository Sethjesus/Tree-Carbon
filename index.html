
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>🌳JP ESG 碳儲存計算🌲</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#28a745">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
    body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: rgba(255, 255, 255, 0.1) url('https://raw.githubusercontent.com/Sethjesus/Tree-Carbon/main/Plant.jpg') no-repeat top center;
    background-size: cover; /* 調整為 cover 讓背景完整顯示 */
    background-attachment: fixed;
    width: 100%;
    max-width: 100%;
    min-height: 100vh;
    margin: 0 auto;
    overflow-x: hidden; /* 防止水平滾動 */
}

.content {
    width: 95%;
    max-width: 500px; /* 限制內容最大寬度 */
    background: rgba(255, 255, 255, 0.85);
    padding: 20px;
    border-radius: 10px;
    margin: 20px auto;
    text-align: center;
}

/* 修正標題過寬問題 */
h1, h2 {
    display: inline-block;
    max-width: 100%;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    text-align: center;
    margin: 10px auto;
}

/* 調整輸入框對齊 */
.input-group {
    width: 100%;
    max-width: 300px;
    margin: 0 auto 15px;
}

.input-group label {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
    display: block;
}

.input-group input,
.input-group select {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    text-align: center;
    border-radius: 5px;
    border: 1px solid #ccc;
    display: block;
}

/* 調整按鈕大小 */
button {
    width: 100%;
    max-width: 300px;
    margin: 10px auto;
    display: block;
    padding: 12px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    transition: 0.3s;
    background: #28a745;
    color: white;
}

button:hover {
    background: #218838;
}

/* 清除按鈕 */
.clr-btn {
    background: #dc3545;
}

.clr-btn:hover {
    background: #c82333;
}

/* 表格調整 */
.table-container {
    width: 100%;
    max-width: 500px;
    margin: 20px auto;
    overflow-x: auto;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    padding: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}

td:last-child {
    font-weight: bold;
    color: #28a745;
}

/* 修正連結按鈕 */
.link-btn {
    display: inline-block;
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    margin-top: 10px;
}

.link-btn:hover {
    background-color: #45a049;
}


   .input-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-bottom: 15px;
}

.input-group label {
    font-size: 18px;
    font-weight: bold;
    color: #333;  /* Use dark text for readability */
    margin-bottom: 5px;
}

.input-group input {
    width: 90%;
    max-width: 300px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    text-align: center;
}

select {
    width: 100%;
    max-width: 250px;
    padding: 10px;
    font-size: 16px;
    text-align: center;
    border-radius: 5px;
    border: 1px solid #ccc;
}

    </style>
</head>
<body>
    <div class="content">
        <h1>🌴JP ESG 碳儲存計算🌳</h1>
        <h2>校園碳匯推廣方案</h2>
        <BR>
            <div class="input-group">
    <label>選擇學校名稱：</label>
   <select id="schoolSelect">
  <option value="">請選擇國小</option>

  <!-- 基隆市 -->
  <optgroup label="基隆市">
    <option value="基隆市中和國小">基隆市中和國小</option>
    <option value="基隆市仙洞國小">基隆市仙洞國小</option>
    <option value="基隆市七堵國小">基隆市七堵國小</option>
    <option value="基隆市華興國小">基隆市華興國小</option>
    <option value="基隆市中正國小">基隆市中正國小</option>
    <option value="基隆市正濱國小">基隆市正濱國小</option>
    <option value="基隆市忠孝國小">基隆市忠孝國小</option>
    <option value="基隆市和平國小">基隆市和平國小</option>
    <option value="基隆市八斗國小">基隆市八斗國小</option>
    <!-- … 此處可補其他區所有校名 … -->
  </optgroup>

  <!-- 新北市 -->
  <optgroup label="新北市">
    <option value="新北市板橋國小">新北市板橋國小</option>
    <option value="新北市國光國小">新北市國光國小</option>
    <option value="新北市文德國小">新北市文德國小</option>
    <!-- 以上資料取材自板橋區通訊錄:contentReference[oaicite:1]{index=1} -->
    <option value="新北市淡水區新市國小">新北市淡水區新市國小</option>
    <option value="新北市新店區新店國小">新北市新店區新店國小</option>
    <option value="新北市新莊區新莊國小">新北市新莊區新莊國小</option>
    <option value="新北市板橋區板橋國小">新北市板橋區板橋國小</option>
    <!-- 可補充其他學校 -->
  </optgroup>

  <!-- 台北市 -->
  <optgroup label="台北市">
    <option value="台北市日新國小">台北市日新國小</option>
    <option value="台北市太平國小">台北市太平國小</option>
    <option value="台北市永樂國小">台北市永樂國小</option>
    <option value="台北市幸安國小">台北市幸安國小</option>
    <!-- 該資料來自台北市教育局列表:contentReference[oaicite:2]{index=2} -->
  </optgroup>

  <!-- 桃園市 -->
  <optgroup label="桃園市">
    <option value="桃園市桃園國小">桃園市桃園國小</option>
    <option value="桃園市東門國小">桃園市東門國小</option>
    <option value="桃園市中埔國小">桃園市中埔國小</option>
    <option value="桃園市成功國小">桃園市成功國小</option>
    <!-- 資料來源桃園市教育局:contentReference[oaicite:3]{index=3} -->
  </optgroup>
</select>

     </div>

        <label>選擇樹種：<BR>
            <select id="treeType"></select>
        </label>
       <div class="input-group">
    <label>輸入樹高（公尺）：</label>
    <input type="number" id="treeHeight" value="10">
</div>

<div class="input-group">
    <label>輸入胸高直徑（公分）：</label>
    <input type="number" id="treeDiameter" value="10">
</div>

<div class="input-group">
    <label>輸入樹木數量：</label>
    <input type="number" id="treeCount" value="1">
</div>

    
        <button id="calculateBtn">計算碳儲存量</button>
        <button id="exportExcel">匯出 Excel</button>
        <button id="clearTable" class="clr-btn">CLR</button>
        <button id="installPWA" style="display: none;">📥 下載應用程式</button>
    
        <h2>碳儲存量比較表：</h2>
        <div class="table-container">
            <table id="carbonTable">
        <thead>
        <tr>
        <th>#</th>
        <th>學校名稱</th> <!-- 新增 -->
        <th>林型</th>
        <th>樹高 (m)</th>
        <th>胸高直徑 (cm)</th>
        <th>數量</th>
        <th>(kg CO₂e)</th>
        </tr>
        </thead>

                <tbody></tbody>
            </table>
        </div>
    
        <h2 id="totalCarbon">總碳儲存量: 0 公斤 CO₂e</h2>
    </div>
    
    <script>
        const treeData = [
            { type: "天然針葉林", BEF: 1.27, R: 0.22, CF: 0.4821, Rho: 0.41, FF: 0.45 },
            { type: "天然針闊葉混交林", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "天然闊葉林", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.56, FF: 0.45 },
            { type: "人工針葉林", BEF: 1.27, R: 0.22, CF: 0.4821, Rho: 0.41, FF: 0.45 },
            { type: "人工針闊葉混交林", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "人工闊葉林", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.56, FF: 0.45 },
            { type: "木竹混交林", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "竹林", BEF: 1.4, R: 0.46, CF: 0.4732, Rho: 0.62, FF: 0.45 },
            { type: "龍柏立木", BEF: 1.4, R: 0.24, CF: 0.4908, Rho: 0.704, FF: 0.4 },
            { type: "台灣櫟樹", BEF: 1.4, R: 0.24, CF: 0.4743, Rho: 0.6, FF: 0.4 },
            { type: "小葉南洋杉", BEF: 1.4, R: 0.24, CF: 0.4821, Rho: 0.48, FF: 0.4 },
            { type: "芒果樹", BEF: 1.4, R: 0.24, CF: 0.4474, Rho: 0.55, FF: 0.4 },
            { type: "楓香", BEF: 1.4, R: 0.24, CF: 0.489, Rho: 0.49, FF: 0.4 },
            { type: "流蘇", BEF: 1.4, R: 0.24, CF: 0.469, Rho: 0.68, FF: 0.4 },
            { type: "大王椰子", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.5, FF: 0.4 },
            { type: "榕樹", BEF: 1.4, R: 0.24, CF: 0.4356, Rho: 0.41, FF: 0.4 },
            { type: "山櫻花", BEF: 1.4, R: 0.24, CF: 0.4773, Rho: 0.59, FF: 0.4 },
        ];
    
        function populateTreeTypes() {
            let select = document.getElementById("treeType");
            select.innerHTML = "";
            treeData.forEach(tree => {
                let option = document.createElement("option");
                option.value = tree.type;
                option.textContent = tree.type;
                select.appendChild(option);
            });
        }
    
        document.addEventListener("DOMContentLoaded", () => {
            populateTreeTypes();
            document.getElementById("calculateBtn").addEventListener("click", calculateCarbon);
            document.getElementById("exportExcel").addEventListener("click", exportToExcel);
            document.getElementById("clearTable").addEventListener("click", clearTable);

            // 監聽 PWA 安裝提示
            window.addEventListener("beforeinstallprompt", (event) => {
                event.preventDefault();
                deferredPrompt = event;
                
                // 顯示「下載應用程式」按鈕
                let installButton = document.getElementById("installPWA");
                installButton.style.display = "block";
        
                installButton.addEventListener("click", () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt(); // 顯示安裝對話框
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === "accepted") {
                                console.log("使用者接受了 PWA 安裝");
                            } else {
                                console.log("使用者拒絕了 PWA 安裝");
                            }
                            deferredPrompt = null;
                            installButton.style.display = "none"; // 安裝完成後隱藏按鈕
                        });
                    }
                });
            });

            // 監聽 PWA 是否已安裝
            window.addEventListener("appinstalled", () => {
                console.log("PWA 已安裝！");
                document.getElementById("installPWA").style.display = "none"; // 隱藏按鈕
            });
        });
    
        let totalCarbonStorage = 0;
        let serialNumber = 1;
    
        function calculateCarbon() {
            let tableBody = document.querySelector("#carbonTable tbody");
            let height = parseFloat(document.getElementById("treeHeight").value);
            let dbh = parseFloat(document.getElementById("treeDiameter").value) / 100;
            let count = parseInt(document.getElementById("treeCount").value, 10);
            let selectedTree = treeData.find(tree => tree.type === document.getElementById("treeType").value);
            let school = document.getElementById("schoolSelect").value;
            if (!school) {
            alert("請選擇學校名稱！");
            return;
}

            if (!selectedTree) return;
    
            let co2e = Math.PI * Math.pow(dbh / 2, 2) * height * selectedTree.FF *
            selectedTree.Rho * selectedTree.BEF * (1 + selectedTree.R) *
            selectedTree.CF * (44 / 12) * count * 1000;   // ← ★乘 1000
            totalCarbonStorage += co2e;
            let newRow = tableBody.insertRow();
            newRow.innerHTML = `<td>${serialNumber++}</td>
                    <td>${school}</td>
                    <td>${selectedTree.type}</td>
                    <td>${height}</td>
                    <td>${(dbh * 100).toFixed(2)}</td>
                    <td>${count}</td>
                    <td>${co2e.toFixed(4)}</td>`;

    
            document.getElementById("totalCarbon").innerText = `總碳儲存量: ${totalCarbonStorage.toFixed(4)} 公斤 CO₂e`;
        }
    
        function clearTable() {
            let tableBody = document.querySelector("#carbonTable tbody");
            tableBody.innerHTML = "";  // 清空表格內容
            totalCarbonStorage = 0;  // 重置總碳儲存量
            serialNumber = 1;  // 重置序號
            document.getElementById("totalCarbon").innerText = `總碳儲存量: 0 公斤 CO₂e`;
        }
    
        function exportToExcel() {
            let tableData = Array.from(document.querySelectorAll("#carbonTable tbody tr")).map(row => {
                return Array.from(row.children).map(td => td.innerText);
            });
    
            let ws = XLSX.utils.aoa_to_sheet([["#", "學校名稱", "林型", "樹高 (m)", "胸高直徑 (cm)", "數量", "(kg CO₂e)"], ...tableData]);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "碳儲存計算");
            XLSX.writeFile(wb, "carbon_storage.xlsx");
        }
    
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/service-worker.js")
                .then(reg => console.log("Service Worker registered!", reg))
                .catch(err => console.log("Service Worker registration failed!", err));
        }
    
        let deferredPrompt;
    </script>
</body>
<a href="https://data.moa.gov.tw/open_search.aspx?id=I82" target="_blank" class="link-btn">資料來源農業部資料開放平台</a>
<a href="https://jpesg.netlify.app/" target="_blank" class="link-btn">JPESG 官網</a>

</html>
