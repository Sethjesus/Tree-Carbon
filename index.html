<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ğŸŒ³JP ESG ç¢³å„²å­˜è¨ˆç®—ğŸŒ²</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#28a745">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
    body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: rgba(255, 255, 255, 0.3) url('https://raw.githubusercontent.com/Sethjesus/Tree-Carbon/main/Plant.jpg') no-repeat top center;
    background-size: cover; /* èª¿æ•´ç‚º cover è®“èƒŒæ™¯å®Œæ•´é¡¯ç¤º */
    background-attachment: fixed;
    width: 100%;
    max-width: 100%;
    min-height: 100vh;
    margin: 0 auto;
    overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
}

.content {
    width: 95%;
    max-width: 500px; /* é™åˆ¶å…§å®¹æœ€å¤§å¯¬åº¦ */
    background: rgba(255, 255, 255, 0.85);
    padding: 20px;
    border-radius: 10px;
    margin: 20px auto;
    text-align: center;
}

/* ä¿®æ­£æ¨™é¡Œéå¯¬å•é¡Œ */
h1, h2 {
    display: inline-block;
    max-width: 100%;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    text-align: center;
    margin: 10px auto;
}

/* èª¿æ•´è¼¸å…¥æ¡†å°é½Š */
.input-group {
    width: 100%;
    max-width: 300px;
    margin: 0 auto 15px;
}

.input-group label {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
    display: block;
}

.input-group input,
.input-group select {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    text-align: center;
    border-radius: 5px;
    border: 1px solid #ccc;
    display: block;
}

/* èª¿æ•´æŒ‰éˆ•å¤§å° */
button {
    width: 100%;
    max-width: 300px;
    margin: 10px auto;
    display: block;
    padding: 12px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    transition: 0.3s;
    background: #28a745;
    color: white;
}

button:hover {
    background: #218838;
}

/* æ¸…é™¤æŒ‰éˆ• */
.clr-btn {
    background: #dc3545;
}

.clr-btn:hover {
    background: #c82333;
}

/* è¡¨æ ¼èª¿æ•´ */
.table-container {
    width: 100%;
    max-width: 500px;
    margin: 20px auto;
    overflow-x: auto;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    padding: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}

td:last-child {
    font-weight: bold;
    color: #28a745;
}

/* ä¿®æ­£é€£çµæŒ‰éˆ• */
.link-btn {
    display: inline-block;
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    margin-top: 10px;
}

.link-btn:hover {
    background-color: #45a049;
}


   .input-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-bottom: 15px;
}

.input-group label {
    font-size: 18px;
    font-weight: bold;
    color: #333;  /* Use dark text for readability */
    margin-bottom: 5px;
}

.input-group input {
    width: 90%;
    max-width: 300px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    text-align: center;
}

select {
    width: 100%;
    max-width: 250px;
    padding: 10px;
    font-size: 16px;
    text-align: center;
    border-radius: 5px;
    border: 1px solid #ccc;
}

    </style>
</head>
<body>
    <div class="content">
        <h1>ğŸŒ´JP ESG ç¢³å„²å­˜è¨ˆç®—ğŸŒ³</h1>
        <h2>æ ¡åœ’ç¢³åŒ¯æ¨å»£æ–¹æ¡ˆ</h2>
        <BR>
        <label>é¸æ“‡æ¨¹ç¨®ï¼š<BR>
            <select id="treeType"></select>
        </label>
       <div class="input-group">
    <label>è¼¸å…¥æ¨¹é«˜ï¼ˆå…¬å°ºï¼‰ï¼š</label>
    <input type="number" id="treeHeight" value="10">
</div>

<div class="input-group">
    <label>è¼¸å…¥èƒ¸é«˜ç›´å¾‘ï¼ˆå…¬åˆ†ï¼‰ï¼š</label>
    <input type="number" id="treeDiameter" value="10">
</div>

<div class="input-group">
    <label>è¼¸å…¥æ¨¹æœ¨æ•¸é‡ï¼š</label>
    <input type="number" id="treeCount" value="1">
</div>

    
        <button id="calculateBtn">è¨ˆç®—ç¢³å„²å­˜é‡</button>
        <button id="exportExcel">åŒ¯å‡º Excel</button>
        <button id="clearTable" class="clr-btn">CLR</button>
        <button id="installPWA" style="display: none;">ğŸ“¥ ä¸‹è¼‰æ‡‰ç”¨ç¨‹å¼</button>
    
        <h2>ç¢³å„²å­˜é‡æ¯”è¼ƒè¡¨ï¼š</h2>
        <div class="table-container">
            <table id="carbonTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>æ—å‹</th>
                        <th>æ¨¹é«˜ (m)</th>
                        <th>èƒ¸é«˜ç›´å¾‘ (cm)</th>
                        <th>æ•¸é‡</th>
                        <th>(kg COâ‚‚e)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    
        <h2 id="totalCarbon">ç¸½ç¢³å„²å­˜é‡: 0 å…¬æ–¤ COâ‚‚e</h2>
    </div>
    
    <script>
        const treeData = [
            { type: "å¤©ç„¶é‡è‘‰æ—", BEF: 1.27, R: 0.22, CF: 0.4821, Rho: 0.41, FF: 0.45 },
            { type: "å¤©ç„¶é‡é—Šè‘‰æ··äº¤æ—", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "å¤©ç„¶é—Šè‘‰æ—", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.56, FF: 0.45 },
            { type: "äººå·¥é‡è‘‰æ—", BEF: 1.27, R: 0.22, CF: 0.4821, Rho: 0.41, FF: 0.45 },
            { type: "äººå·¥é‡é—Šè‘‰æ··äº¤æ—", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "äººå·¥é—Šè‘‰æ—", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.56, FF: 0.45 },
            { type: "æœ¨ç«¹æ··äº¤æ—", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "ç«¹æ—", BEF: 1.4, R: 0.46, CF: 0.4732, Rho: 0.62, FF: 0.45 }
        ];
    
        function populateTreeTypes() {
            let select = document.getElementById("treeType");
            select.innerHTML = "";
            treeData.forEach(tree => {
                let option = document.createElement("option");
                option.value = tree.type;
                option.textContent = tree.type;
                select.appendChild(option);
            });
        }
    
        document.addEventListener("DOMContentLoaded", () => {
            populateTreeTypes();
            document.getElementById("calculateBtn").addEventListener("click", calculateCarbon);
            document.getElementById("exportExcel").addEventListener("click", exportToExcel);
            document.getElementById("clearTable").addEventListener("click", clearTable);

            // ç›£è½ PWA å®‰è£æç¤º
            window.addEventListener("beforeinstallprompt", (event) => {
                event.preventDefault();
                deferredPrompt = event;
                
                // é¡¯ç¤ºã€Œä¸‹è¼‰æ‡‰ç”¨ç¨‹å¼ã€æŒ‰éˆ•
                let installButton = document.getElementById("installPWA");
                installButton.style.display = "block";
        
                installButton.addEventListener("click", () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt(); // é¡¯ç¤ºå®‰è£å°è©±æ¡†
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === "accepted") {
                                console.log("ä½¿ç”¨è€…æ¥å—äº† PWA å®‰è£");
                            } else {
                                console.log("ä½¿ç”¨è€…æ‹’çµ•äº† PWA å®‰è£");
                            }
                            deferredPrompt = null;
                            installButton.style.display = "none"; // å®‰è£å®Œæˆå¾Œéš±è—æŒ‰éˆ•
                        });
                    }
                });
            });

            // ç›£è½ PWA æ˜¯å¦å·²å®‰è£
            window.addEventListener("appinstalled", () => {
                console.log("PWA å·²å®‰è£ï¼");
                document.getElementById("installPWA").style.display = "none"; // éš±è—æŒ‰éˆ•
            });
        });
    
        let totalCarbonStorage = 0;
        let serialNumber = 1;
    
        function calculateCarbon() {
            let tableBody = document.querySelector("#carbonTable tbody");
            let height = parseFloat(document.getElementById("treeHeight").value);
            let dbh = parseFloat(document.getElementById("treeDiameter").value) / 100;
            let count = parseInt(document.getElementById("treeCount").value, 10);
            let selectedTree = treeData.find(tree => tree.type === document.getElementById("treeType").value);
    
            if (!selectedTree) return;
    
            let co2e = Math.PI * Math.pow(dbh / 2, 2) * height * selectedTree.FF * selectedTree.Rho * selectedTree.BEF * (1 + selectedTree.R) * selectedTree.CF * (44 / 12) * count;
            totalCarbonStorage += co2e;
    
            let newRow = tableBody.insertRow();
            newRow.innerHTML = `<td>${serialNumber++}</td>
                                <td>${selectedTree.type}</td>
                                <td>${height}</td>
                                <td>${(dbh * 100).toFixed(2)}</td>
                                <td>${count}</td>
                                <td>${co2e.toFixed(4)}</td>`;
    
            document.getElementById("totalCarbon").innerText = `ç¸½ç¢³å„²å­˜é‡: ${totalCarbonStorage.toFixed(4)} å…¬æ–¤ COâ‚‚e`;
        }
    
        function clearTable() {
            let tableBody = document.querySelector("#carbonTable tbody");
            tableBody.innerHTML = "";  // æ¸…ç©ºè¡¨æ ¼å…§å®¹
            totalCarbonStorage = 0;  // é‡ç½®ç¸½ç¢³å„²å­˜é‡
            serialNumber = 1;  // é‡ç½®åºè™Ÿ
            document.getElementById("totalCarbon").innerText = `ç¸½ç¢³å„²å­˜é‡: 0 å…¬æ–¤ COâ‚‚e`;
        }
    
        function exportToExcel() {
            let tableData = Array.from(document.querySelectorAll("#carbonTable tbody tr")).map(row => {
                return Array.from(row.children).map(td => td.innerText);
            });
    
            let ws = XLSX.utils.aoa_to_sheet([["#", "æ—å‹", "æ¨¹é«˜ (m)", "èƒ¸é«˜ç›´å¾‘ (cm)", "æ•¸é‡", "(kg COâ‚‚e)"], ...tableData]);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ç¢³å„²å­˜è¨ˆç®—");
            XLSX.writeFile(wb, "carbon_storage.xlsx");
        }
    
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/service-worker.js")
                .then(reg => console.log("Service Worker registered!", reg))
                .catch(err => console.log("Service Worker registration failed!", err));
        }
    
        let deferredPrompt;
    </script>
</body>
<a href="https://data.moa.gov.tw/open_search.aspx?id=I82" target="_blank" class="link-btn">è³‡æ–™ä¾†æºè¾²æ¥­éƒ¨è³‡æ–™é–‹æ”¾å¹³å°</a>
<a href="https://jpesg.netlify.app/" target="_blank" class="link-btn">JPESG å®˜ç¶²</a>

</html>
