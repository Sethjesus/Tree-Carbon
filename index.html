<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JP ESG 碳儲存計算</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#28a745">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
      body {
    font-family: Arial, sans-serif;
    text-align: center;
   
    background: rgba(255, 255, 255, 0.3) url('https://raw.githubusercontent.com/Sethjesus/Tree-Carbon/main/Plant.jpg') no-repeat top center;
    background-size: contain;
    background-attachment: fixed;/
    width: 100%;
    max-width: 682px;
    min-height: 100vh;
    margin: 0 auto;
    overflow: auto; /* Allow scrolling */
}




        }
       .content {
    width: 100%;
    max-width: 500px; /* 限制寬度 */
    background: rgba(255, 255, 255, 0.85); /* 背景色 */
    padding: 20px;
    border-radius: 10px;
    margin: 0 auto;
    text-align: center;
}


       select, input, button {
    width: 90%;
    max-width: 250px; /* 統一最大寬度 */
    margin: 5px auto;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background: white;
    display: block; /* 讓所有元素統一對齊 */
    text-align: center;
        }
        label {
            color: #eef7ef; 
            font-size: 20px;
            font-weight: bold;
            display: block;
           
        }
        .table-container {
    width: 100%;
    max-height: 300px; /* 調整更大高度 */
    overflow-y: auto;
    margin-bottom: 10px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    padding: 10px;
}

       table {
    width: 100%;
    max-width: 620px;
    margin: 0 auto;
    border-collapse: collapse;
    font-size: 14px;
}

th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center; /* 統一置中對齊 */
    vertical-align: middle; /* 垂直置中 */
}

td:last-child {
    font-weight: bold;
    color: #28a745;
}

       h1, h2 {
    display: inline-block; /* 讓標題根據內容大小縮放 */
    max-width: 90%; /* 防止超出範圍 */
    background: rgba(0, 0, 0, 0.6); /* 背景顏色 */
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    text-align: center;
    white-space: nowrap; /* 防止換行 */
}

      button {
    background: #28a745;
    color: white;
    cursor: pointer;
    transition: 0.3s;
    padding: 12px;
    border-radius: 5px;
    font-size: 16px;
    border: none;
    width: 100%;
    max-width: 250px;
    display: block;
    margin: 10px auto;
}

        button:hover {
            background: #218838;
        }
        .clr-btn {
            background: #dc3545;
        }
        .clr-btn:hover {
            background: #c82333;
        }
        .link-btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: #4CAF50; /* 綠色背景 */
            color: white;
            text-decoration: none;
            border-radius: 5px; /* 圓角 */
            font-size: 16px;
            font-weight: bold;
        }
        .link-btn:hover {
            background-color: #45a049; /* 滑鼠懸停時變深色 */
        }

       .input-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-bottom: 15px;
}

.input-group label {
    font-size: 18px;
    font-weight: bold;
    color: #333;  /* Use dark text for readability */
    margin-bottom: 5px;
}

.input-group input {
    width: 90%;
    max-width: 300px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    text-align: center;
}

select {
    width: 100%;
    max-width: 250px;
    padding: 10px;
    font-size: 16px;
    text-align: center;
    border-radius: 5px;
    border: 1px solid #ccc;
}

    </style>
</head>
<body>
    <div class="content">
        <h1>JP ESG 碳儲存計算</h1>
        <h2>校園碳匯推廣方案</h2>
        
        <label>選擇樹種：
            <select id="treeType"></select>
        </label>
       <div class="input-group">
    <label>輸入樹高（公尺）：</label>
    <input type="number" id="treeHeight" value="10">
</div>

<div class="input-group">
    <label>輸入胸高直徑（公分）：</label>
    <input type="number" id="treeDiameter" value="10">
</div>

<div class="input-group">
    <label>輸入樹木數量：</label>
    <input type="number" id="treeCount" value="1">
</div>

    
        <button id="calculateBtn">計算碳儲存量</button>
        <button id="exportExcel">匯出 Excel</button>
        <button id="clearTable" class="clr-btn">CLR</button>
    
        <h2>碳儲存量比較表：</h2>
        <div class="table-container">
            <table id="carbonTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>林型</th>
                        <th>樹高 (m)</th>
                        <th>胸高直徑 (cm)</th>
                        <th>數量</th>
                        <th>(kg CO₂e)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    
        <h2 id="totalCarbon">總碳儲存量: 0 公斤 CO₂e</h2>
    </div>
    
    <script>
        const treeData = [
            { type: "天然針葉林", BEF: 1.27, R: 0.22, CF: 0.4821, Rho: 0.41, FF: 0.45 },
            { type: "天然針闊葉混交林", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "天然闊葉林", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.56, FF: 0.45 },
            { type: "人工針葉林", BEF: 1.27, R: 0.22, CF: 0.4821, Rho: 0.41, FF: 0.45 },
            { type: "人工針闊葉混交林", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "人工闊葉林", BEF: 1.4, R: 0.24, CF: 0.4691, Rho: 0.56, FF: 0.45 },
            { type: "木竹混交林", BEF: 1.34, R: 0.23, CF: 0.4756, Rho: 0.49, FF: 0.45 },
            { type: "竹林", BEF: 1.4, R: 0.46, CF: 0.4732, Rho: 0.62, FF: 0.45 }
        ];
    
        function populateTreeTypes() {
            let select = document.getElementById("treeType");
            select.innerHTML = "";
            treeData.forEach(tree => {
                let option = document.createElement("option");
                option.value = tree.type;
                option.textContent = tree.type;
                select.appendChild(option);
            });
        }
    
        document.addEventListener("DOMContentLoaded", () => {
            populateTreeTypes();
            document.getElementById("calculateBtn").addEventListener("click", calculateCarbon);
            document.getElementById("exportExcel").addEventListener("click", exportToExcel);
            document.getElementById("clearTable").addEventListener("click", clearTable);
        });
    
        let totalCarbonStorage = 0;
        let serialNumber = 1;
    
        function calculateCarbon() {
            let tableBody = document.querySelector("#carbonTable tbody");
            let height = parseFloat(document.getElementById("treeHeight").value);
            let dbh = parseFloat(document.getElementById("treeDiameter").value) / 100;
            let count = parseInt(document.getElementById("treeCount").value, 10);
            let selectedTree = treeData.find(tree => tree.type === document.getElementById("treeType").value);
    
            if (!selectedTree) return;
    
            let co2e = Math.PI * Math.pow(dbh / 2, 2) * height * selectedTree.FF * selectedTree.Rho * selectedTree.BEF * (1 + selectedTree.R) * selectedTree.CF * (44 / 12) * count;
            totalCarbonStorage += co2e;
    
            let newRow = tableBody.insertRow();
            newRow.innerHTML = `<td>${serialNumber++}</td>
                                <td>${selectedTree.type}</td>
                                <td>${height}</td>
                                <td>${(dbh * 100).toFixed(2)}</td>
                                <td>${count}</td>
                                <td>${co2e.toFixed(4)}</td>`;
    
            document.getElementById("totalCarbon").innerText = `總碳儲存量: ${totalCarbonStorage.toFixed(4)} 公斤 CO₂e`;
        }
    
        function clearTable() {
            let tableBody = document.querySelector("#carbonTable tbody");
            tableBody.innerHTML = "";  // 清空表格內容
            totalCarbonStorage = 0;  // 重置總碳儲存量
            serialNumber = 1;  // 重置序號
            document.getElementById("totalCarbon").innerText = `總碳儲存量: 0 公斤 CO₂e`;
        }
    
        function exportToExcel() {
            let tableData = Array.from(document.querySelectorAll("#carbonTable tbody tr")).map(row => {
                return Array.from(row.children).map(td => td.innerText);
            });
    
            let ws = XLSX.utils.aoa_to_sheet([["#", "林型", "樹高 (m)", "胸高直徑 (cm)", "數量", "(kg CO₂e)"], ...tableData]);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "碳儲存計算");
            XLSX.writeFile(wb, "carbon_storage.xlsx");
        }
    
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js")
                .then(reg => console.log("Service Worker registered!", reg))
                .catch(err => console.log("Service Worker registration failed!", err));
        }
    </script>
</body>
<a href="https://data.moa.gov.tw/open_search.aspx?id=I82" target="_blank" class="link-btn">資料來源農業部資料開放平台</a>
</html>
